<h1 id="remote-node-reconfiguration">Remote node reconfiguration</h1>

<p>This advanced-level tutorial shows how to do the following:</p>

<ul>
  <li>Add support for standard configuration services to a node.</li>
  <li>Get, set, save, or erase configuration parameters on a remote node via UAVCAN.</li>
</ul>

<p>These are the standard configuration services defined by the UAVCAN specification:</p>

<ul>
  <li><code class="highlighter-rouge">uavcan.protocol.param.GetSet</code></li>
  <li><code class="highlighter-rouge">uavcan.protocol.param.ExecuteOpcode</code></li>
</ul>

<p>Please read the specification for more info.</p>

<p>Two applications are implemented in this tutorial:</p>

<ul>
  <li>Configurator - the node that can alter configuration parameters of a remote node via UAVCAN.</li>
  <li>Remote node - the node that supports remote reconfiguration.</li>
</ul>

<h2 id="configurator">Configurator</h2>

<p>Once started, this node performs the following:</p>

<ul>
  <li>Reads all configuration parameters from a remote node (the user must enter the node ID of the remote node).</li>
  <li>Sets all parameters to their maximum values.</li>
  <li>Resets all parameters back to their default values.</li>
  <li>Restarts the remote node.</li>
  <li>Exits.</li>
</ul>

<div class="language-cpp highlighter-rouge"><pre class="highlight"><code><span class="cp">#include &lt;iostream&gt;
#include &lt;unistd.h&gt;
#include &lt;vector&gt;
#include &lt;uavcan/uavcan.hpp&gt;
</span>
<span class="cm">/*
 * Remote reconfiguration services.
 */</span>
<span class="cp">#include &lt;uavcan/protocol/param/GetSet.hpp&gt;
#include &lt;uavcan/protocol/param/ExecuteOpcode.hpp&gt;
</span>
<span class="k">extern</span> <span class="n">uavcan</span><span class="o">::</span><span class="n">ICanDriver</span><span class="o">&amp;</span> <span class="n">getCanDriver</span><span class="p">();</span>
<span class="k">extern</span> <span class="n">uavcan</span><span class="o">::</span><span class="n">ISystemClock</span><span class="o">&amp;</span> <span class="n">getSystemClock</span><span class="p">();</span>

<span class="k">constexpr</span> <span class="kt">unsigned</span> <span class="n">NodeMemoryPoolSize</span> <span class="o">=</span> <span class="mi">16384</span><span class="p">;</span>

<span class="cm">/**
 * Convenience function for blocking service calls.
 */</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="k">typename</span> <span class="n">T</span><span class="o">::</span><span class="n">Response</span><span class="o">&gt;</span> <span class="n">performBlockingServiceCall</span><span class="p">(</span><span class="n">uavcan</span><span class="o">::</span><span class="n">INode</span><span class="o">&amp;</span> <span class="n">node</span><span class="p">,</span>
                                                                <span class="n">uavcan</span><span class="o">::</span><span class="n">NodeID</span> <span class="n">remote_node_id</span><span class="p">,</span>
                                                                <span class="k">const</span> <span class="k">typename</span> <span class="n">T</span><span class="o">::</span><span class="n">Request</span><span class="o">&amp;</span> <span class="n">request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">bool</span> <span class="n">success</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">typename</span> <span class="n">T</span><span class="o">::</span><span class="n">Response</span> <span class="n">response</span><span class="p">;</span>  <span class="c1">// Generated types have zero-initializing constructors, always.
</span>
    <span class="n">uavcan</span><span class="o">::</span><span class="n">ServiceClient</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">client</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
    <span class="n">client</span><span class="p">.</span><span class="n">setCallback</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](</span><span class="k">const</span> <span class="n">uavcan</span><span class="o">::</span><span class="n">ServiceCallResult</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span> <span class="n">result</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">success</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">isSuccessful</span><span class="p">();</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">getResponse</span><span class="p">();</span>
        <span class="p">});</span>

    <span class="k">const</span> <span class="kt">int</span> <span class="n">call_res</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="n">remote_node_id</span><span class="p">,</span> <span class="n">request</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">call_res</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">client</span><span class="p">.</span><span class="n">hasPendingCalls</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="k">const</span> <span class="kt">int</span> <span class="n">spin_res</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="n">spin</span><span class="p">(</span><span class="n">uavcan</span><span class="o">::</span><span class="n">MonotonicDuration</span><span class="o">::</span><span class="n">fromMSec</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">spin_res</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="p">{</span><span class="n">spin_res</span><span class="p">,</span> <span class="n">response</span><span class="p">};</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">success</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="o">-</span><span class="n">uavcan</span><span class="o">::</span><span class="n">ErrFailure</span><span class="p">,</span> <span class="n">response</span><span class="p">};</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">call_res</span><span class="p">,</span> <span class="n">response</span><span class="p">};</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"Usage: "</span> <span class="o">&lt;&lt;</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">" &lt;node-id&gt; &lt;remote-node-id&gt;"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">const</span> <span class="n">uavcan</span><span class="o">::</span><span class="n">NodeID</span> <span class="n">self_node_id</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">stoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="k">const</span> <span class="n">uavcan</span><span class="o">::</span><span class="n">NodeID</span> <span class="n">remote_node_id</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">stoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>

    <span class="n">uavcan</span><span class="o">::</span><span class="n">Node</span><span class="o">&lt;</span><span class="n">NodeMemoryPoolSize</span><span class="o">&gt;</span> <span class="n">node</span><span class="p">(</span><span class="n">getCanDriver</span><span class="p">(),</span> <span class="n">getSystemClock</span><span class="p">());</span>
    <span class="n">node</span><span class="p">.</span><span class="n">setNodeID</span><span class="p">(</span><span class="n">self_node_id</span><span class="p">);</span>
    <span class="n">node</span><span class="p">.</span><span class="n">setName</span><span class="p">(</span><span class="s">"org.uavcan.tutorial.configurator"</span><span class="p">);</span>

    <span class="k">const</span> <span class="kt">int</span> <span class="n">node_start_res</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">node_start_res</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">"Failed to start the node; error: "</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">node_start_res</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="n">node</span><span class="p">.</span><span class="n">setModeOperational</span><span class="p">();</span>

    <span class="cm">/*
     * Reading all params from the remote node (access by index); printing request/response
     * to stdout in YAML format.
     * Note that access by index should be used only to list params, not to get or set them.
     */</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">GetSet</span><span class="o">::</span><span class="n">Response</span><span class="o">&gt;</span> <span class="n">remote_params</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">GetSet</span><span class="o">::</span><span class="n">Request</span> <span class="n">req</span><span class="p">;</span>
        <span class="n">req</span><span class="p">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">remote_params</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Param GET request:</span><span class="se">\n</span><span class="s">"</span> <span class="o">&lt;&lt;</span> <span class="n">req</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="k">auto</span> <span class="n">res</span> <span class="o">=</span> <span class="n">performBlockingServiceCall</span><span class="o">&lt;</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">GetSet</span><span class="o">&gt;</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">remote_node_id</span><span class="p">,</span> <span class="n">req</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">first</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">"Failed to get param: "</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">first</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="n">name</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>  <span class="c1">// Empty name means no such param, which means we're finished
</span>        <span class="p">{</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Param read done!</span><span class="se">\n\n</span><span class="s">"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Response:</span><span class="se">\n</span><span class="s">"</span> <span class="o">&lt;&lt;</span> <span class="n">res</span><span class="p">.</span><span class="n">second</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="n">remote_params</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">second</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/*
     * Setting all parameters to their maximum values, if applicable. Access by name.
     */</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">p</span> <span class="o">:</span> <span class="n">remote_params</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">max_value</span><span class="p">.</span><span class="n">is</span><span class="p">(</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">NumericValue</span><span class="o">::</span><span class="n">Tag</span><span class="o">::</span><span class="n">empty</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Maximum value for parameter '"</span> <span class="o">&lt;&lt;</span> <span class="n">p</span><span class="p">.</span><span class="n">name</span><span class="p">.</span><span class="n">c_str</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"' is not defined."</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">GetSet</span><span class="o">::</span><span class="n">Request</span> <span class="n">req</span><span class="p">;</span>
        <span class="n">req</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">max_value</span><span class="p">.</span><span class="n">is</span><span class="p">(</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">NumericValue</span><span class="o">::</span><span class="n">Tag</span><span class="o">::</span><span class="n">integer_value</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">req</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">to</span><span class="o">&lt;</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">Value</span><span class="o">::</span><span class="n">Tag</span><span class="o">::</span><span class="n">integer_value</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">=</span>
                <span class="n">p</span><span class="p">.</span><span class="n">max_value</span><span class="p">.</span><span class="n">to</span><span class="o">&lt;</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">NumericValue</span><span class="o">::</span><span class="n">Tag</span><span class="o">::</span><span class="n">integer_value</span><span class="o">&gt;</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">max_value</span><span class="p">.</span><span class="n">is</span><span class="p">(</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">NumericValue</span><span class="o">::</span><span class="n">Tag</span><span class="o">::</span><span class="n">real_value</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">req</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">to</span><span class="o">&lt;</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">Value</span><span class="o">::</span><span class="n">Tag</span><span class="o">::</span><span class="n">real_value</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">=</span>
                <span class="n">p</span><span class="p">.</span><span class="n">max_value</span><span class="p">.</span><span class="n">to</span><span class="o">&lt;</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">NumericValue</span><span class="o">::</span><span class="n">Tag</span><span class="o">::</span><span class="n">real_value</span><span class="o">&gt;</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">"Unknown tag in NumericValue: "</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">max_value</span><span class="p">.</span><span class="n">getTag</span><span class="p">()));</span>
        <span class="p">}</span>

        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Param SET request:</span><span class="se">\n</span><span class="s">"</span> <span class="o">&lt;&lt;</span> <span class="n">req</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="k">auto</span> <span class="n">res</span> <span class="o">=</span> <span class="n">performBlockingServiceCall</span><span class="o">&lt;</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">GetSet</span><span class="o">&gt;</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">remote_node_id</span><span class="p">,</span> <span class="n">req</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">first</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">"Failed to set param: "</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">first</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Response:</span><span class="se">\n</span><span class="s">"</span> <span class="o">&lt;&lt;</span> <span class="n">res</span><span class="p">.</span><span class="n">second</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Param set done!</span><span class="se">\n\n</span><span class="s">"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="cm">/*
     * Reset all params back to their default values.
     */</span>
    <span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">ExecuteOpcode</span><span class="o">::</span><span class="n">Request</span> <span class="n">opcode_req</span><span class="p">;</span>
    <span class="n">opcode_req</span><span class="p">.</span><span class="n">opcode</span> <span class="o">=</span> <span class="n">opcode_req</span><span class="p">.</span><span class="n">OPCODE_ERASE</span><span class="p">;</span>
    <span class="k">auto</span> <span class="n">erase_res</span> <span class="o">=</span>
        <span class="n">performBlockingServiceCall</span><span class="o">&lt;</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">ExecuteOpcode</span><span class="o">&gt;</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">remote_node_id</span><span class="p">,</span> <span class="n">opcode_req</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">erase_res</span><span class="p">.</span><span class="n">first</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">"Failed to erase params: "</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">erase_res</span><span class="p">.</span><span class="n">first</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Param erase response:</span><span class="se">\n</span><span class="s">"</span> <span class="o">&lt;&lt;</span> <span class="n">erase_res</span><span class="p">.</span><span class="n">second</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Param erase done!</span><span class="se">\n\n</span><span class="s">"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="cm">/*
     * Restart the remote node.
     */</span>
    <span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">RestartNode</span><span class="o">::</span><span class="n">Request</span> <span class="n">restart_req</span><span class="p">;</span>
    <span class="n">restart_req</span><span class="p">.</span><span class="n">magic_number</span> <span class="o">=</span> <span class="n">restart_req</span><span class="p">.</span><span class="n">MAGIC_NUMBER</span><span class="p">;</span>
    <span class="k">auto</span> <span class="n">restart_res</span> <span class="o">=</span> <span class="n">performBlockingServiceCall</span><span class="o">&lt;</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">RestartNode</span><span class="o">&gt;</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">remote_node_id</span><span class="p">,</span> <span class="n">restart_req</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">restart_res</span><span class="p">.</span><span class="n">first</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">"Failed to restart: "</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">restart_res</span><span class="p">.</span><span class="n">first</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Restart response:</span><span class="se">\n</span><span class="s">"</span> <span class="o">&lt;&lt;</span> <span class="n">restart_res</span><span class="p">.</span><span class="n">second</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Restart done!"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</code></pre>
</div>

<h2 id="remote-node">Remote node</h2>

<p>This node doesn’t do anything on its own; it merely provides the standard configuration services.</p>

<div class="language-cpp highlighter-rouge"><pre class="highlight"><code><span class="cp">#include &lt;iostream&gt;
#include &lt;cstdlib&gt;
#include &lt;unistd.h&gt;
#include &lt;uavcan/uavcan.hpp&gt;
</span>
<span class="cm">/*
 * Implementations for the standard application-level functions are located in uavcan/protocol/.
 * The same path also contains the standard data types uavcan.protocol.*.
 */</span>
<span class="cp">#include &lt;uavcan/protocol/param_server.hpp&gt;
</span>
<span class="k">extern</span> <span class="n">uavcan</span><span class="o">::</span><span class="n">ICanDriver</span><span class="o">&amp;</span> <span class="n">getCanDriver</span><span class="p">();</span>
<span class="k">extern</span> <span class="n">uavcan</span><span class="o">::</span><span class="n">ISystemClock</span><span class="o">&amp;</span> <span class="n">getSystemClock</span><span class="p">();</span>

<span class="k">constexpr</span> <span class="kt">unsigned</span> <span class="n">NodeMemoryPoolSize</span> <span class="o">=</span> <span class="mi">16384</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"Usage: "</span> <span class="o">&lt;&lt;</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">" &lt;node-id&gt;"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">const</span> <span class="kt">int</span> <span class="n">self_node_id</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">stoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

    <span class="n">uavcan</span><span class="o">::</span><span class="n">Node</span><span class="o">&lt;</span><span class="n">NodeMemoryPoolSize</span><span class="o">&gt;</span> <span class="n">node</span><span class="p">(</span><span class="n">getCanDriver</span><span class="p">(),</span> <span class="n">getSystemClock</span><span class="p">());</span>
    <span class="n">node</span><span class="p">.</span><span class="n">setNodeID</span><span class="p">(</span><span class="n">self_node_id</span><span class="p">);</span>
    <span class="n">node</span><span class="p">.</span><span class="n">setName</span><span class="p">(</span><span class="s">"org.uavcan.tutorial.configuree"</span><span class="p">);</span>

    <span class="k">const</span> <span class="kt">int</span> <span class="n">node_start_res</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">node_start_res</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">"Failed to start the node; error: "</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">node_start_res</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="cm">/*
     * This would be our configuration storage.
     */</span>
    <span class="k">static</span> <span class="k">struct</span> <span class="n">Params</span>
    <span class="p">{</span>
        <span class="kt">unsigned</span> <span class="n">foo</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">bar</span> <span class="o">=</span> <span class="mf">0.123456</span><span class="n">F</span><span class="p">;</span>
        <span class="kt">double</span> <span class="n">baz</span> <span class="o">=</span> <span class="mf">1e-5</span><span class="p">;</span>
        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">booz</span> <span class="o">=</span> <span class="s">"Hello world!"</span><span class="p">;</span>
    <span class="p">}</span> <span class="n">configuration</span><span class="p">;</span>

    <span class="cm">/*
     * Now, we need to define some glue logic between the server (below) and our configuration storage (above).
     * This is done via the interface uavcan::IParamManager.
     */</span>
    <span class="k">class</span> <span class="err">:</span> <span class="nc">public</span> <span class="n">uavcan</span><span class="o">::</span><span class="n">IParamManager</span>
    <span class="p">{</span>
        <span class="kt">void</span> <span class="n">getParamNameByIndex</span><span class="p">(</span><span class="n">Index</span> <span class="n">index</span><span class="p">,</span> <span class="n">Name</span><span class="o">&amp;</span> <span class="n">out_name</span><span class="p">)</span> <span class="k">const</span> <span class="n">override</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="n">out_name</span> <span class="o">=</span> <span class="s">"foo"</span><span class="p">;</span> <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="n">out_name</span> <span class="o">=</span> <span class="s">"bar"</span><span class="p">;</span> <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span> <span class="n">out_name</span> <span class="o">=</span> <span class="s">"baz"</span><span class="p">;</span> <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span> <span class="n">out_name</span> <span class="o">=</span> <span class="s">"booz"</span><span class="p">;</span> <span class="p">}</span>
        <span class="p">}</span>

        <span class="kt">void</span> <span class="n">assignParamValue</span><span class="p">(</span><span class="k">const</span> <span class="n">Name</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">,</span> <span class="k">const</span> <span class="n">Value</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">)</span> <span class="n">override</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s">"foo"</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="cm">/*
                 * Parameter "foo" is an integer, so we accept only integer values here.
                 */</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">is</span><span class="p">(</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">Value</span><span class="o">::</span><span class="n">Tag</span><span class="o">::</span><span class="n">integer_value</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="n">configuration</span><span class="p">.</span><span class="n">foo</span> <span class="o">=</span> <span class="o">*</span><span class="n">value</span><span class="p">.</span><span class="n">as</span><span class="o">&lt;</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">Value</span><span class="o">::</span><span class="n">Tag</span><span class="o">::</span><span class="n">integer_value</span><span class="o">&gt;</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s">"bar"</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="cm">/*
                 * Parameter "bar" is a floating point, so we accept only float values here.
                 */</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">is</span><span class="p">(</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">Value</span><span class="o">::</span><span class="n">Tag</span><span class="o">::</span><span class="n">real_value</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="n">configuration</span><span class="p">.</span><span class="n">bar</span> <span class="o">=</span> <span class="o">*</span><span class="n">value</span><span class="p">.</span><span class="n">as</span><span class="o">&lt;</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">Value</span><span class="o">::</span><span class="n">Tag</span><span class="o">::</span><span class="n">real_value</span><span class="o">&gt;</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s">"baz"</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="cm">/*
                 * Ditto
                 */</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">is</span><span class="p">(</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">Value</span><span class="o">::</span><span class="n">Tag</span><span class="o">::</span><span class="n">real_value</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="n">configuration</span><span class="p">.</span><span class="n">baz</span> <span class="o">=</span> <span class="o">*</span><span class="n">value</span><span class="p">.</span><span class="n">as</span><span class="o">&lt;</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">Value</span><span class="o">::</span><span class="n">Tag</span><span class="o">::</span><span class="n">real_value</span><span class="o">&gt;</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s">"booz"</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="cm">/*
                 * Parameter "booz" is a string, so we take only strings.
                 */</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">is</span><span class="p">(</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">Value</span><span class="o">::</span><span class="n">Tag</span><span class="o">::</span><span class="n">string_value</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="n">configuration</span><span class="p">.</span><span class="n">booz</span> <span class="o">=</span> <span class="n">value</span><span class="p">.</span><span class="n">as</span><span class="o">&lt;</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">Value</span><span class="o">::</span><span class="n">Tag</span><span class="o">::</span><span class="n">string_value</span><span class="o">&gt;</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">c_str</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Can't assign parameter: "</span> <span class="o">&lt;&lt;</span> <span class="n">name</span><span class="p">.</span><span class="n">c_str</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="kt">void</span> <span class="n">readParamValue</span><span class="p">(</span><span class="k">const</span> <span class="n">Name</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">,</span> <span class="n">Value</span><span class="o">&amp;</span> <span class="n">out_value</span><span class="p">)</span> <span class="k">const</span> <span class="n">override</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s">"foo"</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">out_value</span><span class="p">.</span><span class="n">to</span><span class="o">&lt;</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">Value</span><span class="o">::</span><span class="n">Tag</span><span class="o">::</span><span class="n">integer_value</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">=</span> <span class="n">configuration</span><span class="p">.</span><span class="n">foo</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s">"bar"</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">out_value</span><span class="p">.</span><span class="n">to</span><span class="o">&lt;</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">Value</span><span class="o">::</span><span class="n">Tag</span><span class="o">::</span><span class="n">real_value</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">=</span> <span class="n">configuration</span><span class="p">.</span><span class="n">bar</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s">"baz"</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">out_value</span><span class="p">.</span><span class="n">to</span><span class="o">&lt;</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">Value</span><span class="o">::</span><span class="n">Tag</span><span class="o">::</span><span class="n">real_value</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">=</span> <span class="n">configuration</span><span class="p">.</span><span class="n">baz</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s">"booz"</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">out_value</span><span class="p">.</span><span class="n">to</span><span class="o">&lt;</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">Value</span><span class="o">::</span><span class="n">Tag</span><span class="o">::</span><span class="n">string_value</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">=</span> <span class="n">configuration</span><span class="p">.</span><span class="n">booz</span><span class="p">.</span><span class="n">c_str</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Can't read parameter: "</span> <span class="o">&lt;&lt;</span> <span class="n">name</span><span class="p">.</span><span class="n">c_str</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="kt">int</span> <span class="n">saveAllParams</span><span class="p">()</span> <span class="n">override</span>
        <span class="p">{</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Save - this implementation does not require any action"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>     <span class="c1">// Zero means that everything is fine.
</span>        <span class="p">}</span>

        <span class="kt">int</span> <span class="n">eraseAllParams</span><span class="p">()</span> <span class="n">override</span>
        <span class="p">{</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Erase - all params reset to default values"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="n">configuration</span> <span class="o">=</span> <span class="n">Params</span><span class="p">();</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="cm">/**
         * Note that this method is optional. It can be left unimplemented.
         */</span>
        <span class="kt">void</span> <span class="n">readParamDefaultMaxMin</span><span class="p">(</span><span class="k">const</span> <span class="n">Name</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">,</span> <span class="n">Value</span><span class="o">&amp;</span> <span class="n">out_def</span><span class="p">,</span>
                                    <span class="n">NumericValue</span><span class="o">&amp;</span> <span class="n">out_max</span><span class="p">,</span> <span class="n">NumericValue</span><span class="o">&amp;</span> <span class="n">out_min</span><span class="p">)</span> <span class="k">const</span> <span class="n">override</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s">"foo"</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">out_def</span><span class="p">.</span><span class="n">to</span><span class="o">&lt;</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">Value</span><span class="o">::</span><span class="n">Tag</span><span class="o">::</span><span class="n">integer_value</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">=</span> <span class="n">Params</span><span class="p">().</span><span class="n">foo</span><span class="p">;</span>
                <span class="n">out_max</span><span class="p">.</span><span class="n">to</span><span class="o">&lt;</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">NumericValue</span><span class="o">::</span><span class="n">Tag</span><span class="o">::</span><span class="n">integer_value</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">=</span> <span class="mi">9000</span><span class="p">;</span>
                <span class="n">out_min</span><span class="p">.</span><span class="n">to</span><span class="o">&lt;</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">NumericValue</span><span class="o">::</span><span class="n">Tag</span><span class="o">::</span><span class="n">integer_value</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s">"bar"</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">out_def</span><span class="p">.</span><span class="n">to</span><span class="o">&lt;</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">Value</span><span class="o">::</span><span class="n">Tag</span><span class="o">::</span><span class="n">real_value</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">=</span> <span class="n">Params</span><span class="p">().</span><span class="n">bar</span><span class="p">;</span>
                <span class="n">out_max</span><span class="p">.</span><span class="n">to</span><span class="o">&lt;</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">NumericValue</span><span class="o">::</span><span class="n">Tag</span><span class="o">::</span><span class="n">real_value</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="n">out_min</span><span class="p">.</span><span class="n">to</span><span class="o">&lt;</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">NumericValue</span><span class="o">::</span><span class="n">Tag</span><span class="o">::</span><span class="n">real_value</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s">"baz"</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">out_def</span><span class="p">.</span><span class="n">to</span><span class="o">&lt;</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">Value</span><span class="o">::</span><span class="n">Tag</span><span class="o">::</span><span class="n">real_value</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">=</span> <span class="n">Params</span><span class="p">().</span><span class="n">baz</span><span class="p">;</span>
                <span class="n">out_max</span><span class="p">.</span><span class="n">to</span><span class="o">&lt;</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">NumericValue</span><span class="o">::</span><span class="n">Tag</span><span class="o">::</span><span class="n">real_value</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="n">out_min</span><span class="p">.</span><span class="n">to</span><span class="o">&lt;</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">NumericValue</span><span class="o">::</span><span class="n">Tag</span><span class="o">::</span><span class="n">real_value</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s">"booz"</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">out_def</span><span class="p">.</span><span class="n">to</span><span class="o">&lt;</span><span class="n">uavcan</span><span class="o">::</span><span class="n">protocol</span><span class="o">::</span><span class="n">param</span><span class="o">::</span><span class="n">Value</span><span class="o">::</span><span class="n">Tag</span><span class="o">::</span><span class="n">string_value</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">=</span> <span class="n">Params</span><span class="p">().</span><span class="n">booz</span><span class="p">.</span><span class="n">c_str</span><span class="p">();</span>
                <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Limits for 'booz' are not defined"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Can't read the limits for parameter: "</span> <span class="o">&lt;&lt;</span> <span class="n">name</span><span class="p">.</span><span class="n">c_str</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="n">param_manager</span><span class="p">;</span>

    <span class="cm">/*
     * Initializing the configuration server.
     * A pointer to the glue logic object is passed to the method start().
     */</span>
    <span class="n">uavcan</span><span class="o">::</span><span class="n">ParamServer</span> <span class="n">server</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>

    <span class="k">const</span> <span class="kt">int</span> <span class="n">server_start_res</span> <span class="o">=</span> <span class="n">server</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="o">&amp;</span><span class="n">param_manager</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">server_start_res</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">"Failed to start ParamServer: "</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">server_start_res</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="cm">/*
     * Now, this node can be reconfigured via UAVCAN. Awesome.
     * Many embedded applications require a restart before the new configuration settings can
     * be applied, so it is highly recommended to also support the remote restart service.
     */</span>
    <span class="k">class</span> <span class="err">:</span> <span class="nc">public</span> <span class="n">uavcan</span><span class="o">::</span><span class="n">IRestartRequestHandler</span>
    <span class="p">{</span>
        <span class="kt">bool</span> <span class="n">handleRestartRequest</span><span class="p">(</span><span class="n">uavcan</span><span class="o">::</span><span class="n">NodeID</span> <span class="n">request_source</span><span class="p">)</span> <span class="n">override</span>
        <span class="p">{</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Got a remote restart request from "</span> <span class="o">&lt;&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">request_source</span><span class="p">.</span><span class="n">get</span><span class="p">())</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="cm">/*
             * We won't really restart, so return 'false'.
             * Returning 'true' would mean that we're going to restart for real.
             * Note that it is recognized that some nodes may not be able to respond to the
             * restart request (e.g. if they restart immediately from the service callback).
             */</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="n">restart_request_handler</span><span class="p">;</span>

    <span class="cm">/*
     * Installing the restart request handler.
     */</span>
    <span class="n">node</span><span class="p">.</span><span class="n">setRestartRequestHandler</span><span class="p">(</span><span class="o">&amp;</span><span class="n">restart_request_handler</span><span class="p">);</span> <span class="c1">// Done.
</span>
    <span class="cm">/*
     * Running the node.
     */</span>
    <span class="n">node</span><span class="p">.</span><span class="n">setModeOperational</span><span class="p">();</span>
    <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">const</span> <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="n">spin</span><span class="p">(</span><span class="n">uavcan</span><span class="o">::</span><span class="n">MonotonicDuration</span><span class="o">::</span><span class="n">getInfinite</span><span class="p">());</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">res</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"Transient failure: "</span> <span class="o">&lt;&lt;</span> <span class="n">res</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre>
</div>

<h2 id="running-on-linux">Running on Linux</h2>

<p>Build the applications using the following CMake script:</p>

<div class="language-cmake highlighter-rouge"><pre class="highlight"><code><span class="nb">cmake_minimum_required</span><span class="p">(</span>VERSION 2.8<span class="p">)</span>

<span class="nb">project</span><span class="p">(</span>tutorial_project<span class="p">)</span>

<span class="nb">find_library</span><span class="p">(</span>UAVCAN_LIB uavcan REQUIRED<span class="p">)</span>

<span class="nb">set</span><span class="p">(</span>CMAKE_CXX_FLAGS <span class="s2">"-Wall -Wextra -pedantic -std=c++11"</span><span class="p">)</span>

<span class="c1"># Make sure to provide correct path to 'platform_linux.cpp'! See earlier tutorials for more info.</span>
<span class="nb">add_executable</span><span class="p">(</span>configurator configurator.cpp <span class="si">${</span><span class="nv">CMAKE_SOURCE_DIR</span><span class="si">}</span>/../2._Node_initialization_and_startup/platform_linux.cpp<span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span>configurator <span class="si">${</span><span class="nv">UAVCAN_LIB</span><span class="si">}</span> rt<span class="p">)</span>

<span class="nb">add_executable</span><span class="p">(</span>remote_node remote_node.cpp <span class="si">${</span><span class="nv">CMAKE_SOURCE_DIR</span><span class="si">}</span>/../2._Node_initialization_and_startup/platform_linux.cpp<span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span>remote_node <span class="si">${</span><span class="nv">UAVCAN_LIB</span><span class="si">}</span> rt<span class="p">)</span>

</code></pre>
</div>
