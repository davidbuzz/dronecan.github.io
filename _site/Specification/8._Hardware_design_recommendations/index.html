<h1 id="hardware-design-recommendations">Hardware design recommendations</h1>

<p>This chapter contains best-practice recommendations for hardware design.</p>

<p>Following these guidelines will ensure the highest level of inter-vendor compatibility
and allow the developers to avoid many common design pitfalls.</p>

<h2 id="physical-connector-definition">Physical connector definition</h2>

<p><a class="imagelink" href="/Specification/figures/connector_size_comparison.png" data-lightbox="/Specification/figures/connector_size_comparison.png" data-title="Size comparison of different DroneCAN connector types. The blue PCB is a small UAV avionic device given for scale.">
<img src="/Specification/figures/connector_size_comparison.png" class="thumbnail" style="" />
</a></p>

<p>The DroneCAN standard defines several connector types, targeted towards different application domains:
from highly compact systems to large deployments, from low-cost to safety-critical applications.</p>

<p>The following table provides an overview of the currently defined connector types.
The image to the right comparatively demonstrates the size of the connector types.</p>

<p>Other connector types may be added in future revisions of the specification.</p>

<table>
  <thead>
    <tr>
      <th>Connector name</th>
      <th>Base connector type</th>
      <th>Bus power</th>
      <th>Known compatible standards</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong><span style="white-space: nowrap;">DroneCAN D-Sub</span></strong></td>
      <td>Generic D-Subminiature DE-9</td>
      <td>24 V, 3 A</td>
      <td>De-facto standard connector for CAN, supported by many current specifications</td>
    </tr>
    <tr>
      <td><strong><span style="white-space: nowrap;">DroneCAN M8</span></strong></td>
      <td>Generic M8 5-circuit B-coded</td>
      <td>24 V, 3 A</td>
      <td>CiA 103 (CANopen)</td>
    </tr>
    <tr>
      <td><strong><span style="white-space: nowrap;">DroneCAN Micro</span></strong></td>
      <td>JST GH 4-circuit</td>
      <td>5 V, 1 A</td>
      <td>Dronecode Autopilot Connector Standard</td>
    </tr>
  </tbody>
</table>

<h3 id="dronecan-d-sub-connector">DroneCAN D-Sub connector</h3>

<p><a class="imagelink" href="/Specification/figures/de-9_connector_male_plug.jpg" data-lightbox="/Specification/figures/de-9_connector_male_plug.jpg" data-title="DroneCAN D-Sub male plug connector. (https://commons.wikimedia.org/wiki/File:Serial_plug1.jpg)">
<img src="/Specification/figures/de-9_connector_male_plug.jpg" class="thumbnail" style="" />
</a></p>

<p><a class="imagelink" href="/Specification/figures/de-9_cable_female_socket.jpg" data-lightbox="/Specification/figures/de-9_cable_female_socket.jpg" data-title="DroneCAN D-Sub cable with female socket connectors. (https://www.flickr.com/photos/57018633@N04/5662914060/)">
<img src="/Specification/figures/de-9_cable_female_socket.jpg" class="thumbnail" style="" />
</a></p>

<p><a class="imagelink" href="/Specification/figures/de-9_pin_numbering.png" data-lightbox="/Specification/figures/de-9_pin_numbering.png" data-title="DE-9 connector pin numbering.">
<img src="/Specification/figures/de-9_pin_numbering.png" class="thumbnail" style="" />
</a></p>

<p>The DroneCAN D-Sub connector type is based upon, and compatible with, the D-Subminiature DE-9 CAN connector (this is the most popular CAN connector type, in effect the de-facto industry standard). 
This connector is fully compatible with CANopen and many other current specifications.</p>

<h4 id="advantages">Advantages</h4>

<ul>
  <li>Highest level of compatibility with the existing commercial off the shelf (COTS) hardware.
Connectors, cables, termination plugs, and other components can be easily purchased from many different vendors.</li>
  <li>High-reliability options are available from multiple vendors.</li>
  <li>Low-cost options are available from multiple vendors.</li>
  <li>PCB mounted and panel mounted types are available.</li>
</ul>

<h4 id="disadvantages">Disadvantages</h4>

<p>D-Subminiature connectors are the largest connector type defined by DroneCAN.
Due to its significant size and weight, it may be unsuitable for many vehicular applications.</p>

<h4 id="specification">Specification</h4>

<p>The DroneCAN D-Sub connector is based on the industry-standard <strong>D-Sub DE-9</strong> (9-circuit) connector type.
Devices are equipped with the male plug connector type (see the image) mounted on the panel or on the PCB,
and the cables are equipped with the female socket connectors on both ends.</p>

<p>If the device uses two parallel connectors per CAN bus interface (as recommended), then all of the lines
of the paired connectors, including those that are not used by the current specification,
must be interconnected one to one.
This will ensure compatibility with future revisions of the specification that make use of currently unused
circuits of the connector.</p>

<p>The CAN physical layer standard that can be used with this connector type is
<a href="http://www.can-cia.org/index.php?id=systemdesign-can-physicallayer#high">ISO 11898-2</a>,
also known as high-speed CAN.</p>

<p>Devices that deliver power to the bus are required to provide 23.0—30.0 V on the bus power line, 24 V nominal.
The maximum current draw is up to 3 A per connector.</p>

<p>Devices that are powered from the bus should expect 18.0—30.0 V on the bus power line.
The maximum recommended current draw from the bus is 500 mA per device.</p>

<p>The table below documents the pinout specification for the DroneCAN D-Sub connector type.
The provided pinout, as has been indicated above, is the de-facto industry standard for the CAN bus.
Note that the signals <code class="highlighter-rouge">CAN High</code> and <code class="highlighter-rouge">CAN Low</code> must belong to the same twisted pair.
Usage of twisted or flat wires for all other signals remains at the discretion of the implementer.</p>

<table>
  <thead>
    <tr>
      <th>Circuit number</th>
      <th>Function</th>
      <th>Note</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td> </td>
      <td>Reserved for future use.</td>
    </tr>
    <tr>
      <td>2</td>
      <td>CAN Low</td>
      <td>Twisted with CAN High (pin 7).</td>
    </tr>
    <tr>
      <td>3</td>
      <td>CAN Ground</td>
      <td>Must be interconnected with Ground (pin 6) within the device.</td>
    </tr>
    <tr>
      <td>4</td>
      <td> </td>
      <td>Reserved for future use.</td>
    </tr>
    <tr>
      <td>5</td>
      <td>CAN Shield</td>
      <td>Optional.</td>
    </tr>
    <tr>
      <td>6</td>
      <td>Ground</td>
      <td>Must be interconnected with CAN Ground (pin 3) within the device.</td>
    </tr>
    <tr>
      <td>7</td>
      <td>CAN High</td>
      <td>Twisted with CAN Low (pin 2).</td>
    </tr>
    <tr>
      <td>8</td>
      <td> </td>
      <td>Error line, not used by DroneCAN. See CiA 303 for details.</td>
    </tr>
    <tr>
      <td>9</td>
      <td>Bus power supply</td>
      <td>24 V nominal. Power supply requirements are documented above.</td>
    </tr>
  </tbody>
</table>

<h3 id="dronecan-m8-connector">DroneCAN M8 connector</h3>

<p><a class="imagelink" href="/Specification/figures/m8_connector_male_plug.jpg" data-lightbox="/Specification/figures/m8_connector_male_plug.jpg" data-title="DroneCAN M8 male plug connector">
<img src="/Specification/figures/m8_connector_male_plug.jpg" class="thumbnail" style="" />
</a></p>

<p><a class="imagelink" href="/Specification/figures/m8_cable_female_socket.jpg" data-lightbox="/Specification/figures/m8_cable_female_socket.jpg" data-title="DroneCAN M8 cable with female socket connectors">
<img src="/Specification/figures/m8_cable_female_socket.jpg" class="thumbnail" style="" />
</a></p>

<p>The DroneCAN M8 connector is based on the standard circular M8 B-coded 5-circuit connector type (pictured).
This is a popular industry-standard connector, and there are many vendors that manufacture
compatible components: connectors, cables, termination plugs, T-connectors, and so on.
The pinning, physical layer, and supply voltages used in this connector type are compatible with CiA 103 (CANopen)
and some other CAN bus standards.</p>

<p>The M8 connector is preferred for most DroneCAN applications (it is the default choice, except when there are specific reasons to select another connector).</p>

<h4 id="advantages-1">Advantages</h4>

<ul>
  <li>Compatibility with existing COTS hardware.
Connectors, cables, termination plugs, and other components can be purchased from many different vendors.</li>
  <li>High-reliability options are available from multiple vendors.</li>
  <li>Low-cost options are available from multiple vendors.</li>
  <li>Reasonably compact. M8 connectors are much smaller than D-Sub.</li>
  <li>PCB mounted and panel mounted types are available.</li>
</ul>

<h4 id="disadvantages-1">Disadvantages</h4>

<ul>
  <li>M8 connectors may be a poor fit for applications that have severe weight and space constraints.</li>
  <li>The level of adoption in the industry is noticeably lower than that of the D-Sub connector type.</li>
</ul>

<h4 id="specification-1">Specification</h4>

<p>The DroneCAN M8 connector is based on the industry-standard <strong>circular M8 B-coded 5-circuit</strong> connector type.
Devices are equipped with the male plug connector type (see the image) mounted on the panel or on the PCB,
and the cables are equipped with the female socket connectors on both ends.
<em>Do not confuse A-coded and B-coded M8 connectors — they are not mutually compatible</em>.</p>

<p>The CAN physical layer standard that can be used with this connector type is
<a href="http://www.can-cia.org/index.php?id=systemdesign-can-physicallayer#high">ISO 11898-2</a>,
also known as high-speed CAN.</p>

<p>Devices that deliver power to the bus are required to provide 23.0—30.0 V on the bus power line, 24 V nominal.
The maximum current draw is up to 3 A per connector.</p>

<p>Devices that are powered from the bus should expect 18.0—30.0 V on the bus power line.
The maximum recommended current draw from the bus is 500 mA per device.</p>

<p>The table below documents the pinout specification for the DroneCAN M8 connector type.
The provided pinout, as indicated above, is compatible with the CiA 103 specification (CANopen).
Note that the wires <code class="highlighter-rouge">CAN High</code> and <code class="highlighter-rouge">CAN Low</code> should be a twisted pair.</p>

<table>
  <thead>
    <tr>
      <th>Circuit number</th>
      <th>Function</th>
      <th>Note</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>Bus power supply</td>
      <td>24 V nominal. Power supply requirements are documented above.</td>
    </tr>
    <tr>
      <td>2</td>
      <td>CAN Shield</td>
      <td>Optional.</td>
    </tr>
    <tr>
      <td>3</td>
      <td>CAN High</td>
      <td>Twisted with CAN Low (pin 4).</td>
    </tr>
    <tr>
      <td>4</td>
      <td>CAN Low</td>
      <td>Twisted with CAN High (pin 3).</td>
    </tr>
    <tr>
      <td>5</td>
      <td>Ground</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<h3 id="dronecan-micro-connector">DroneCAN Micro connector</h3>

<p><a class="imagelink" href="/Specification/figures/jst_gh_patch_cable.jpg" data-lightbox="/Specification/figures/jst_gh_patch_cable.jpg" data-title="DroneCAN Micro patch cable (twisted)">
<img src="/Specification/figures/jst_gh_patch_cable.jpg" class="thumbnail" style="" />
</a></p>

<p><a class="imagelink" href="/Specification/figures/jst_gh_termination_plug.jpg" data-lightbox="/Specification/figures/jst_gh_termination_plug.jpg" data-title="DroneCAN Micro termination plug">
<img src="/Specification/figures/jst_gh_termination_plug.jpg" class="thumbnail" style="" />
</a></p>

<p><a class="imagelink" href="/Specification/figures/jst_gh_1st_pin_mark.png" data-lightbox="/Specification/figures/jst_gh_1st_pin_mark.png" data-title="Location of the first pin of a JST GH plug is indicated with a mark, as shown on the figure">
<img src="/Specification/figures/jst_gh_1st_pin_mark.png" class="thumbnail" style="" />
</a></p>

<p>The DroneCAN Micro connector is intended for weight- and space-sensitive applications.
It is a board-level connector, meaning that it can be installed on the PCB rather than on the panel.</p>

<p>The Micro connector is compatible with the Dronecode Autopilot Connector Standard.
This connector type is recommended for small UAV and nanosatellites.
It is also the recommended connector for attaching external panel-mounted connectors
(such as the M8 or D-Sub types) to the PCB inside the enclosure.</p>

<h4 id="advantages-2">Advantages</h4>

<ul>
  <li>Extremely compact, low-profile. The PCB footprint is under 9✕5 millimeters.</li>
  <li>Secure positive lock ensures that the connection will not self-disconnect when exposed to vibrations.</li>
  <li>Low-cost, easy to stock.</li>
</ul>

<h4 id="disadvantages-2">Disadvantages</h4>

<ul>
  <li>Board-level connections only. No panel-mounted options available.</li>
  <li>No shielding available.</li>
  <li>Not suitable for safety-critical hardware.</li>
</ul>

<h4 id="specification-2">Specification</h4>

<p>The Micro connector is based on the proprietary
<strong><a href="http://www.jst-mfg.com/product/pdf/eng/eGH.pdf">JST GH</a> 4-circuit</strong>
connector type.</p>

<p>The suitable cable types are flat or twisted pair #30 to #26 AWG, outer insulation diameter 0.8—1.0 mm,
multi-strand.
Non-twisted (flat) cables can only be used in very small deployments free of significant EMI,
otherwise reliable functioning of the bus cannot be guaranteed.</p>

<p>The CAN physical layer standard that can be used with this connector type is
<a href="http://www.can-cia.org/index.php?id=systemdesign-can-physicallayer#high">ISO 11898-2</a>,
also known as high-speed CAN.</p>

<p>Devices that deliver power to the bus are required to provide 5.0—5.5 V on the bus power line.
The anticipated current draw is up to 1 A per connector.</p>

<p>Devices that are powered from the bus should expect 4.0—5.5 V on the bus power line.
The maximum recommended current draw from the bus is 500 mA per device.</p>

<table>
  <thead>
    <tr>
      <th>Circuit number</th>
      <th>Function</th>
      <th>Recommended wire designation for 25-pair-color-coded cables</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>Bus power supply</td>
      <td><img src="/Specification/figures/wire_white_blue_stripe.svg" style="width:4em;" /> pair 1 tip</td>
    </tr>
    <tr>
      <td>2</td>
      <td>CAN High</td>
      <td><img src="/Specification/figures/wire_orange.svg" style="width:4em;" /> pair 2 ring</td>
    </tr>
    <tr>
      <td>3</td>
      <td>CAN Low</td>
      <td><img src="/Specification/figures/wire_white_orange_stripe.svg" style="width:4em;" /> pair 2 tip</td>
    </tr>
    <tr>
      <td>4</td>
      <td>Ground</td>
      <td><img src="/Specification/figures/wire_blue.svg" style="width:4em;" /> pair 1 ring</td>
    </tr>
  </tbody>
</table>

<h2 id="design-recommendations">Design recommendations</h2>

<h3 id="connectors">Connectors</h3>

<p>It is highly recommended to provide two identical parallel connectors for each CAN interface per device,
so that the device can be connected to the bus without the need to use T-connectors.
T-connectors should be avoided when possible because generally they add an extra point of failure,
increase the stub length, weight, and often require more complex and expensive wiring harnesses.</p>

<p>The figure below demonstrates a CAN bus wired according to the above recommendation.</p>

<p><a class="imagelink" href="/Specification/figures/can_chaining_non_redundant.png" data-lightbox="/Specification/figures/can_chaining_non_redundant.png" data-title="Non-redundant CAN bus wiring">
<img src="/Specification/figures/can_chaining_non_redundant.png" class="" style="" />
</a></p>

<p>The next figure shows a bus where the devices are equipped with doubly redundant interfaces.
The same principles apply to a triply-redundant bus as well.</p>

<p><a class="imagelink" href="/Specification/figures/can_chaining_doubly_redundant.png" data-lightbox="/Specification/figures/can_chaining_doubly_redundant.png" data-title="Doubly-redundant CAN bus wiring">
<img src="/Specification/figures/can_chaining_doubly_redundant.png" class="" style="" />
</a></p>

<p>DroneCAN permits keeping one of the redundant interfaces unused.
An example of such wiring is shown on the following figure.</p>

<p><a class="imagelink" href="/Specification/figures/can_chaining_doubly_redundant_one_unused.png" data-lightbox="/Specification/figures/can_chaining_doubly_redundant_one_unused.png" data-title="Non-redundant CAN bus wiring where nodes are equipped with redundant interfaces">
<img src="/Specification/figures/can_chaining_doubly_redundant_one_unused.png" class="" style="" />
</a></p>

<h3 id="devices-with-different-number-of-redundant-interfaces">Devices with different number of redundant interfaces</h3>

<p>Mission critical devices and non-mission critical devices often need to co-exist on the same DroneCAN network.
Non-mission critical devices are likely to be equipped with a non-redundant CAN bus interface,
which can create the situation where multiple devices with a different number of redundant interfaces need to be
connected to the same DroneCAN network.</p>

<p>If multiple devices with a different number of interfaces need to co-exist on the same DroneCAN network,
the following rules should be followed:</p>

<ul>
  <li>Each available CAN bus (DroneCAN supports up to 3) is assigned a level of importance (primary or backup).</li>
  <li>All devices should be connected to the primary CAN bus.</li>
  <li>Only devices with redundant interfaces should be also connected to the backup bus/buses.</li>
</ul>

<p>The figure below shows a doubly redundant CAN bus, but the same considerations apply to a triply redundant bus:</p>

<p><a class="imagelink" href="/Specification/figures/redundant_can_bus.png" data-lightbox="/Specification/figures/redundant_can_bus.png" data-title="Redundant CAN bus">
<img src="/Specification/figures/redundant_can_bus.png" class="" style="" />
</a></p>

<h3 id="bus-power-supply">Bus power supply</h3>

<p><a class="imagelink" href="/Specification/figures/can_phy_power_reference.png" data-lightbox="/Specification/figures/can_phy_power_reference.png" data-title="Example schematic of a bus-powered device with a doubly redundant CAN bus interface">
<img src="/Specification/figures/can_phy_power_reference.png" class="thumbnail" style="" />
</a></p>

<h4 id="bus-powered-devices">Bus-powered devices</h4>

<p>This section applies to devices that draw power from the bus.</p>

<p>Each power input must be protected with an overcurrent protection circuit (for example, a fuse),
so that an accidental short circuit on the device will not bring down the power on the entire bus.</p>

<p>If the device incorporates redundant bus interfaces, it must prevent direct current flow between power inputs
from different interface connectors, so that if one bus suffers a power failure (e.g. a short circuit)
it won’t be propagated to other buses.</p>

<h4 id="bus-powering-devices">Bus-powering devices</h4>

<p>This section applies to devices that deliver power to the bus.</p>

<p>Similar to the case of bus-powered devices,
DroneCAN power sources should take into account that one of the redundant interfaces may suffer a short circuit
or a failure of similar mode.
Should that happen, the power source should shut down the failing bus and continue to supply the remaining
bus interfaces.</p>

<h3 id="can-bus-parameters">CAN bus parameters</h3>

<p>DroneCAN is bit rate agnostic, so technically any bit rate can be used as long as it is supported by the physical layer.
However, only the recommended bit rates from the table below should be used to ensure compatibility.</p>

<p>All recommended bit rates and other relevant CAN bus parameters are listed in the table below.</p>

<table>
  <thead>
    <tr>
      <th>Bit rate</th>
      <th>Valid range for location of sample point</th>
      <th>Recommended location of sample point</th>
      <th>Max bus length</th>
      <th>Max stub length</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1000 kbit/s</td>
      <td>75% to 90%</td>
      <td>87.5%</td>
      <td>40 m</td>
      <td>0.3 m</td>
    </tr>
    <tr>
      <td>500 kbit/s</td>
      <td>85% to 90%</td>
      <td>87.5%</td>
      <td>100 m</td>
      <td>0.3 m</td>
    </tr>
    <tr>
      <td>250 kbit/s</td>
      <td>85% to 90%</td>
      <td>87.5%</td>
      <td>250 m</td>
      <td>0.3 m</td>
    </tr>
    <tr>
      <td>125 kbit/s</td>
      <td>85% to 90%</td>
      <td>87.5%</td>
      <td>500 m</td>
      <td>0.3 m</td>
    </tr>
  </tbody>
</table>

<p>The estimated bus length limits are based on the assumption that the propagation delay does not exceed 5 ns/m,
not including additional delay times of CAN transceivers and other components.</p>

<h4 id="automatic-bit-rate-detection">Automatic bit rate detection</h4>

<p>Designers are encouraged to implement CAN auto bit rate detection when applicable.
Please refer to the CiA 801 application note for recommended practices.</p>

<p>DroneCAN enables the use of the simple bit time measuring approach,
as it is guaranteed that any functioning DroneCAN network will always exchange node status messages,
which can be expected to be published at a rate no lower than 1 Hz,
and that contain a suitable alternating bit pattern in the CAN ID field.
Please refer to the <a href="/Specification/6._Application_level_functions">chapter dedicated to the application-level functions</a>
for details.</p>

<h2 id="see-also">See also</h2>

<ul>
  <li><a href="http://www.ti.com/lit/an/slla270/slla270.pdf">Controller Area Network Physical Layer Requirements</a> (Application Report, SLLA270–January 2008)</li>
  <li><a href="http://www.computer-solutions.co.uk/info/Embedded_tutorials/can_tutorial.htm">CAN and CAN-FD a brief tutorial</a> (www.computer-solutions.co.uk)</li>
  <li><a href="https://www.can-cia.org/standardization/specifications">CAN CiA Specifications</a> (www.can-cia.org)</li>
</ul>
